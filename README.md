## Telegram Chat Daily Summary Bot (Gemini, SQLite, APScheduler)

–õ–æ–∫–∞–ª—å–Ω—ã–π Telegram-–±–æ—Ç, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–±–∏—Ä–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –∏–∑ –≥—Ä—É–ø–ø–æ–≤–æ–≥–æ —á–∞—Ç–∞, —Ä–∞–∑ –≤ –¥–µ–Ω—å (21:00 UTC) –¥–µ–ª–∞–µ—Ç –∫—Ä–∞—Ç–∫–æ–µ —Å–∞–º–º–∞—Ä–∏ —á–µ—Ä–µ–∑ Google Gemini –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ —Ç–æ—Ç –∂–µ —á–∞—Ç.

### –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
- –°–±–æ—Ä –≤—Å–µ—Ö —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ –≥—Ä—É–ø–ø–æ–≤—ã—Ö —á–∞—Ç–æ–≤, –∫–∞–Ω–∞–ª–æ–≤ –∏ —Ñ–æ—Ä—É–º–æ–≤
- **üÜï –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç–µ–º (topics)** –≤ —Ñ–æ—Ä—É–º-–≥—Ä—É–ø–ø–∞—Ö –∏ –∫–∞–Ω–∞–ª–∞—Ö ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Å–∞–º–º–∞—Ä–∏ –¥–ª—è –∫–∞–∂–¥–æ–π —Ç–µ–º—ã
- –•—Ä–∞–Ω–µ–Ω–∏–µ –≤ SQLite (`chat_logs.db`) —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π message_thread_id
- –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è —Å–∞–º–º–∞—Ä–∏–∑–∞—Ü–∏—è –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞ (21:00 UTC) —Å –ø–æ–º–æ—â—å—é Google Gemini
- –ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á ‚Äî APScheduler
- –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞: –ª–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ / Docker

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Python 3.12+
- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è: `TELEGRAM_BOT_TOKEN`, `GEMINI_API_KEY`

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫ (Docker ‚Äî —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ)
1. –°–æ–∑–¥–∞–π—Ç–µ –±–æ—Ç–∞ —á–µ—Ä–µ–∑ @BotFather, –æ—Ç–∫–ª—é—á–∏—Ç–µ —Ä–µ–∂–∏–º –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏ (Bot Settings ‚Üí Group Privacy ‚Üí Turn off)
2. –ü–æ–ª—É—á–∏—Ç–µ API –∫–ª—é—á Gemini –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –µ–≥–æ
3. –°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø–æ —à–∞–±–ª–æ–Ω—É:
   ```env
   TELEGRAM_BOT_TOKEN=123456:ABC...
   GEMINI_API_KEY=your_gemini_key
   GEMINI_MODEL_NAME=gemini-1.5-flash
   SUMMARY_RETENTION_DAYS=14
   ```
4. –ó–∞–ø—É—Å–∫:
   ```bash
   docker compose up --build
   ```
5. –î–æ–±–∞–≤—å—Ç–µ –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø–æ–≤–æ–π —á–∞—Ç, –¥–∞–π—Ç–µ –ø—Ä–∞–≤–∞ —á–∏—Ç–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è

### –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ —Å–∞–º–º–∞—Ä–∏ (—Ä–∞–∑–æ–≤–æ)
- –í –∫–æ–Ω—Å–æ–ª—å (–¥–ª—è –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö —á–∞—Ç–æ–≤ –∑–∞ 24 —á–∞—Å–∞):
  ```bash
  docker compose run --rm bot python run_summary_console.py
  ```
- –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ Telegram (–Ω—É–∂–µ–Ω `TELEGRAM_BOT_TOKEN`):
  ```bash
  docker compose run --rm bot python run_summary_send.py
  ```
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —Ç–µ–º:
  ```bash
  docker compose run --rm bot python test_threads.py
  ```

### –õ–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫ –±–µ–∑ Docker
```bash
python -m venv .venv
source .venv/bin/activate
pip install -r requirements.txt
cp .env.example .env
python bot.py
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞
- `bot.py` ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç –±–æ—Ç–∞
- `db.py` ‚Äî SQLite (–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è, –∑–∞–ø–∏—Å—å/—á—Ç–µ–Ω–∏–µ, –æ—á–∏—Å—Ç–∫–∞)
- `summarizer.py` ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Gemini, –ø—Ä–æ–º–ø—Ç
- `requirements.txt` ‚Äî –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- `.env.example` ‚Äî —à–∞–±–ª–æ–Ω –æ–∫—Ä—É–∂–µ–Ω–∏—è
- `docker-compose.yml`, `Dockerfile` ‚Äî –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è

### –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ë–æ—Ç —Å–ª—É—à–∞–µ—Ç –≤—Å–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è, –∫–∞–∂–¥–æ–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è: `id, chat_id, message_thread_id, user_name, message_text, timestamp`
- –í 21:00 UTC —Å–æ–±–∏—Ä–∞—é—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏—è –∑–∞ 24 —á–∞—Å–∞ –ø–æ –∫–∞–∂–¥–æ–π —Ç–µ–º–µ –æ—Ç–¥–µ–ª—å–Ω–æ
- **–î–ª—è —Ñ–æ—Ä—É–º–æ–≤/–∫–∞–Ω–∞–ª–æ–≤ —Å —Ç–µ–º–∞–º–∏:** —Å–æ–∑–¥–∞—ë—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ–µ —Å–∞–º–º–∞—Ä–∏ –¥–ª—è –∫–∞–∂–¥–æ–π –∞–∫—Ç–∏–≤–Ω–æ–π —Ç–µ–º—ã
- **–î–ª—è –æ–±—ã—á–Ω—ã—Ö —á–∞—Ç–æ–≤:** —Å–æ–∑–¥–∞—ë—Ç—Å—è –æ–±—â–µ–µ —Å–∞–º–º–∞—Ä–∏ –∫–∞–∫ —Ä–∞–Ω—å—à–µ
- –†–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ —Ç–æ—Ç –∂–µ —á–∞—Ç (–∏–ª–∏ —Ç–µ–º—É, –µ—Å–ª–∏ —ç—Ç–æ —Ñ–æ—Ä—É–º)
- –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –∑–∞–ø–∏—Å–µ–π (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 14 –¥–Ω–µ–π)

### –ü—Ä–∏–º–µ—á–∞–Ω–∏—è
- –í—Ä–µ–º—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ ‚Äî UTC (`TZ=UTC`)
- –ï—Å–ª–∏ –∑–∞ —Å—É—Ç–∫–∏ –Ω–µ –±—ã–ª–æ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —á–∞—Ç–µ ‚Äî –æ—Ç–ø—Ä–∞–≤–∫–∏ –Ω–µ –±—É–¥–µ—Ç
- –î–ª—è –æ—Ç–ª–∞–¥–∫–∏ –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ/—Ö—Ä–∞–Ω–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### –õ–∏—Ü–µ–Ω–∑–∏—è
MIT
